# 使用nacos做配置中心

## 添加依赖

```xml
        <!--    nacos 配置管理    -->
        <dependency>
            <groupId>com.alibaba.cloud</groupId>
            <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>
            <version>2023.0.3.2</version>
        </dependency>
```

## 在nacos中增加配置

![img.png](https://img.wmd001.top/blog/2025/11/08/20251108155122466.png)
选择命名空间创建配置.

Data ID 填 **cloud_auth**

选择properties格式,填写配置内容
```properties
server.port=8081

test.key=auth-test
```

## 修改配置文件

```properties
spring.cloud.nacos.config.server-addr=192.168.1.7:8848
spring.cloud.nacos.config.username=nacos
spring.cloud.nacos.config.password=nacos
spring.config.import=nacos:cloud_auth?group=DEFAULT_GROUP
```

## 启动服务,查看配置是否生效

启动服务,服务端口号已经变成了8081,覆盖了原有的配置.
可以看到默认情况下,nacos中的配置文件会覆盖本地的配置文件

## 指定命名空间

```properties
## 值为命名空间ID
spring.cloud.nacos.config.namespace=077df503-0618-48f1-8ed8-835a8f46e5fb
```

命名空间可以区分多个环境,比如开发环境,测试环境,生产环境.可以实现环境隔离,租户隔离,配置隔离.

## 配置刷新

通过 Spring 的 @Value 以及 @NacosConfig 注解设置属性值。
注意：@Value和@NacosConfig都可以将nacos的属性注入到Spring Bean的字段中，两者的区别在于：

@Value是Spring提供的注解，nacos中的属性源是众多属性源之一，通过@Value引用配置值会收到其他属性源的影响，优先级为JVM>ENV>Nacos
@Value默认不支持运行期动态更新，需要结合@RefreshScope注解实现动态刷新，@NacosConfig默认支持运行期动态更新。。
@NacosConfig需要设置目标的dataId和group以及配置中的指定key，不受其他属性源影响，准确性更高。
@NacosConfig支持复杂对象的注入，如自定义JavaBean以及其集合类型，如Set List及Map。
@NacosConfig可以作用于SpringBean，类似@ConfigurationProperties。

在类上使用注解 `@RefreshScope` 启用动态刷新功能,在nacos控制台修改配置并发布后,程序后自动刷新配置.

### `@NacosConfigListener` 接收配置变更回调事件 

通过 `@NacosConfigListener` 接收配置变更回调事件。注解使用在方法上，方法所在的类需要被spring容器管理。

```java
package top.wmd.common;

import com.alibaba.cloud.nacos.annotation.NacosConfigListener;
import org.springframework.stereotype.Component;

@Component
public class ConfigChangeListener {

    /**
     * dataId 和 group 必传,key 可空,不填时默认读取配置中的所有内容 @NacosConfigListener默认不会进行回调初始值，如果需要收到初始值，可以通过指定initNotify=true
     *
     * @param changedData 变更后的配置数据
     */
    @NacosConfigListener(dataId = "cloud_auth", group = "DEFAULT_GROUP", key = "dev.key")
    public void onChange(String changedData) {
        System.out.println("cloud.auth changed, new value: " + changedData);
    }

}
```
